<!DOCTYPE html> {% load static %}
<html>

<head>
    <title>Face Verify</title>
    <script src="{% static 'FaceVerify/js/jquery-3.3.1.min.js' %}"></script>
    <link rel="stylesheet" href="{% static 'FaceVerify/css/bootstrap.min.css' %}">
    <link href="{% static 'FaceVerify/css/fileinput.min.css' %}" media="all" rel="stylesheet" type="text/css" />
    <script src="{% static 'FaceVerify/js/bootstrap.min.js' %}"></script>
    <script src="{% static 'FaceVerify/js/piexif.min.js' %}" type="text/javascript"></script>
    <script src="{% static 'FaceVerify/js/fileinput.min.js' %}" type="text/javascript"></script>
    <script src="{% static 'FaceVerify/js/theme.js' %}"></script>
    <style type="text/css">
        div.rect {
            border: 1px #b4c4d6 solid;
            border-radius: 6px;
            margin-top: 1px;
            margin-bottom: 1px;
        }
        div.left {
            position: fixed;
            top: 150px;
            height: 25%;
            left: 10px;
        }
        div.right {
            position: fixed;
            top: 50%;
            height: 25%;
            left: 10px;
        }
        div.container {
            position: fixed;
            top: 10px;
            bottom: 30px;
            left: 20%;
            right: 10px;
            text-align:center;
            overflow-y: scroll;
        }
    </style>
    
    <script type="text/javascript">
        $(document).ready(function() {
            $("img.face-image").click(function(){
                if (!$("#left")[0].checked && !$("#right")[0].checked)
                    alert("请先选择左侧或右侧复选框");
                if ($("#left")[0].checked)
                    $("#leftImg")[0].src = this.src;
                if ($("#right")[0].checked)
                    $("#rightImg")[0].src = this.src;
            })
            $("#left").change(function(){
                if (this.checked)
                    $("#right")[0].checked = false;
            })
            $("#right").change(function(){
                if (this.checked)
                    $("#left")[0].checked = false;
            })
            $("#compare").click(function(){
                var img1 = $("#leftImg")[0].src;
                var index = img1.lastIndexOf("/") - 1;
                img1 = img1.substring(img1.lastIndexOf("/", index) + 1);
                var img2 = $("#rightImg")[0].src;
                index = img2.lastIndexOf("/") - 1;
                img2 = img2.substring(img2.lastIndexOf("/", index) + 1);
                if (img1.length == 0 || img2.length == 0){
                    alert("请选择需要比较的人脸图片");
                    return;
                }
                $("#compare")[0].disabled = true;
                $("#compare")[0].innerHTML = "请等待..."
                $.ajax({url: 'http://' + window.location.host + "/faceverify/json",
                    data: {func: "compare", data1: img1, data2: img2},
                    success: function(result){
                        $("#compare")[0].disabled = false;
                        $("#compare")[0].innerHTML = "对比";
                        if (!result.flag){
                            alert("比较失败");
                            return;
                        }
                        alert(result.result);
                    } 
                });
            })
        });
    </script>
</head>

<body>
    <h1>人脸识别</h1>
    <div class="rect container">
        {% for face in faceList %}
        <img src="/static/{{face}}" class="face-image">
        {% endfor %}
    </div>
    <div class="rect left">
        <div class="checkbox">
            <label>
                <input type="checkbox" id="left">请选择图片
            </label>
        </div>
        <img id="leftImg">
    </div>
    <div class="rect right">
        <div class="checkbox">
            <label>
                <input type="checkbox" id="right">请选择图片
            </label>
        </div>
        <img id="rightImg">
    </div>
    <!-- Button trigger modal -->
    <button type="button" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#myModal">上传图片</button>
    <button type="button" class="btn btn-success btn-lg" id="compare">对比</button>

    <!-- Modal -->
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">上传人脸图片</h4>
                </div>
                <div class="modal-body">
                    <input id="input-b3" name="input-b3[]" type="file" class="file" multiple data-show-upload="false" data-show-caption="true" data-msg-placeholder="Select {files} for upload...">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    <button type="button" class="btn btn-primary">上传</button>
                </div>
            </div>
        </div>
    </div>
</body>

</html>